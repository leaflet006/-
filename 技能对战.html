<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ€èƒ½å¯¹æˆ˜ Â· æ‰‹åŠ¨è¾“å…¥æŠ€èƒ½ç‰ˆ</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        body {
            background: linear-gradient(145deg, #1a2f3f 0%, #0f1e27 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0;
            padding: 16px;
        }
        .game-container {
            max-width: 1400px;
            width: 100%;
            background: rgba(20, 35, 45, 0.9);
            backdrop-filter: blur(8px);
            border-radius: 48px;
            padding: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.8);
            border: 1px solid #d4a373;
        }
        .setup-panel {
            background: #1e2c3a;
            border-radius: 40px;
            padding: 30px;
            color: #f0e6d2;
            border: 2px solid #b58b5b;
        }
        .setup-title {
            font-size: 3rem;
            text-align: center;
            margin: 0 0 30px;
            text-shadow: 4px 4px 0 #00000060;
            color: #ffd966;
        }
        .setup-row {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }
        .setup-card {
            background: #253745;
            border-radius: 32px;
            padding: 25px;
            flex: 1 1 400px;
            border: 2px solid #c9a87c;
        }
        .setup-card h2 {
            font-size: 2rem;
            margin-top: 0;
            color: #ffd966;
            border-bottom: 2px solid #ac8e68;
            padding-bottom: 10px;
        }
        .setup-input {
            width: 100%;
            padding: 15px 20px;
            font-size: 1.2rem;
            background: #2e4355;
            border: 2px solid #b48b4b;
            color: #f0e6d2;
            border-radius: 60px;
            margin: 10px 0;
        }
        .setup-input:focus {
            outline: none;
            border-color: #ffb347;
            box-shadow: 0 0 15px #ffb347;
        }
        .skill-hint {
            background: #1b2a36;
            padding: 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #7c6a4f;
        }
        .skill-hint table {
            width: 100%;
            color: #e0d3b0;
            border-collapse: collapse;
        }
        .skill-hint td {
            padding: 4px 8px;
            border-bottom: 1px solid #4a5e6b;
        }
        .skill-hint td:first-child {
            color: #ffb347;
            font-weight: bold;
            width: 40px;
        }
        .start-btn {
            background: #d9b382;
            border: none;
            color: #1e2b32;
            font-weight: 800;
            font-size: 2rem;
            padding: 20px 60px;
            border-radius: 60px;
            cursor: pointer;
            border-bottom: 6px solid #8b631c;
            transition: 0.05s linear;
            display: block;
            margin: 20px auto 0;
            box-shadow: 0 5px 15px #00000055;
        }
        .start-btn:active {
            border-bottom-width: 2px;
            transform: translateY(4px);
        }
        .battle-panel {
            display: none;
        }
        .turn-indicator {
            background: #4d3e2e;
            color: #ffddaa;
            font-size: 1.6rem;
            font-weight: bold;
            padding: 16px 32px;
            border-radius: 60px;
            display: inline-block;
            margin-bottom: 20px;
            border: 3px solid #f6c15b;
            box-shadow: 0 6px 0 #7a5610;
        }
        .battlefield {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            justify-content: center;
        }
        .player-card {
            flex: 1 1 400px;
            background: #1e2c3a;
            border-radius: 32px;
            padding: 24px;
            border: 2px solid #d4a373;
            box-shadow: 0 8px 0 #8b5a2b;
            color: #f0e6d2;
            transition: all 0.1s ease;
        }
        .player-card.current-turn {
            border-color: #ffd966;
            box-shadow: 0 0 20px #ffb347, 0 8px 0 #b4652c;
            transform: scale(1.02);
        }
        .player-name {
            font-size: 2.2rem;
            font-weight: 800;
            text-shadow: 3px 3px 0 #00000055;
            margin-bottom: 8px;
        }
        .hp-bar-bg {
            background: #3d2b1a;
            height: 28px;
            border-radius: 30px;
            border: 2px solid #aa7c4f;
            overflow: hidden;
            margin: 16px 0 12px;
        }
        .hp-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #bc3f2c, #e06b4f);
            border-radius: 30px;
            transition: width 0.2s;
            box-shadow: inset 0 2px 5px #ffbb99;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px 20px;
            background: #1b2a36;
            padding: 20px;
            border-radius: 24px;
            margin: 16px 0;
            border: 1px solid #7c6a4f;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            font-size: 1.2rem;
            font-weight: 600;
            background: #253745;
            padding: 8px 16px;
            border-radius: 40px;
            border-bottom: 3px solid #ac8e68;
        }
        .skill-tag {
            display: inline-block;
            background: #384e6b;
            color: #faeac9;
            padding: 6px 16px;
            border-radius: 40px;
            font-size: 0.9rem;
            font-weight: 600;
            margin: 4px 6px 4px 0;
            border: 1px solid #c9a87c;
            box-shadow: 0 2px 0 #624c38;
        }
        .log-panel {
            background: #0d1b24;
            border-radius: 28px;
            padding: 20px;
            margin-top: 30px;
            border: 1px solid #bb8f5a;
            max-height: 200px;
            overflow-y: auto;
            color: #bcd5e0;
            box-shadow: inset 0 0 15px #00000077;
        }
        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid #3d4f5e;
            font-size: 1rem;
            font-family: 'Consolas', monospace;
        }
        .action-btn {
            background: #d9b382;
            border: none;
            color: #1e2b32;
            font-weight: 800;
            font-size: 1.2rem;
            padding: 12px 30px;
            border-radius: 60px;
            cursor: pointer;
            border-bottom: 4px solid #8b631c;
            transition: 0.05s linear;
            margin: 0 10px;
        }
        .action-btn:active {
            border-bottom-width: 2px;
            transform: translateY(2px);
        }
        .action-btn:disabled {
            opacity: 0.4;
            border-bottom-width: 2px;
            transform: translateY(2px);
            pointer-events: none;
        }
        .flex-row {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 20px;
            justify-content: space-between;
        }
    </style>
</head>
<body>
<div class="game-container">
    <!-- ========== è®¾ç½®ç•Œé¢ ========== -->
    <div id="setupPanel" class="setup-panel">
        <h1 class="setup-title">âš”ï¸ æŠ€èƒ½å¯¹æˆ˜ Â· æ‰‹åŠ¨é…å°† âš”ï¸</h1>
        
        <!-- æŠ€èƒ½è¡¨ -->
        <div class="skill-hint">
            <table>
                <tr><th colspan="2" style="text-align: left; color: #ffd966;">ğŸ“– æŠ€èƒ½IDè¡¨ (è¾“å…¥IDï¼Œç©ºæ ¼åˆ†éš”)</th></tr>
                <tr><td>1</td><td>æ™®æ”»</td><td>11</td><td>é‡æ•´æ——é¼“</td></tr>
                <tr><td>2</td><td>åå‡»</td><td>12</td><td>ä¸å±ˆ</td></tr>
                <tr><td>3</td><td>ä¹˜èƒœè¿½å‡»</td><td>13</td><td>å·§å˜</td></tr>
                <tr><td>4</td><td>é“éª‘æ¨ªå†²</td><td>14</td><td>å››é¢æ¥šæ­Œ</td></tr>
                <tr><td>5</td><td>è‰èˆ¹å€Ÿç®­</td><td>15</td><td>è¶ç«æ‰“åŠ«</td></tr>
                <tr><td>6</td><td>äº”é›·è½°é¡¶</td><td>16</td><td>ç‹¼è¢­</td></tr>
                <tr><td>7</td><td>é¿å…¶é”æ°”</td><td>17</td><td>ç ´é‡œæ²‰èˆŸ</td></tr>
                <tr><td>8</td><td>ä»¥æˆ˜å…»æˆ˜</td><td>18</td><td>è‚ƒå†›</td></tr>
                <tr><td>9</td><td>æ–‡æ­¦åŒå…¨</td><td>19</td><td>å¥‡è¢­</td></tr>
                <tr><td>10</td><td>ç ´ç”²</td><td>20</td><td>æ å¤º</td></tr>
                <tr><td></td><td></td><td>21</td><td>æ„ˆæˆ˜æ„ˆå‹‡</td></tr>
            </table>
        </div>

        <div class="setup-row">
            <!-- ç©å®¶1 -->
            <div class="setup-card">
                <h2>ğŸ‘‘ ç©å®¶ 1</h2>
                <input type="text" id="p1Name" class="setup-input" placeholder="åå­—" value="å…³ç¾½">
                <input type="text" id="p1Skills" class="setup-input" placeholder="æŠ€èƒ½ID (ä¾‹å¦‚: 1 2 3 4 5 6 7)" value="1 2 3 4 5 6 7">
            </div>
            <!-- ç©å®¶2 -->
            <div class="setup-card">
                <h2>âš”ï¸ ç©å®¶ 2</h2>
                <input type="text" id="p2Name" class="setup-input" placeholder="åå­—" value="å•å¸ƒ">
                <input type="text" id="p2Skills" class="setup-input" placeholder="æŠ€èƒ½ID (ä¾‹å¦‚: 8 9 10 11 12 13 14)" value="8 9 10 11 12 13 14">
            </div>
        </div>
        <button class="start-btn" id="startGameBtn">â–¶ å¼€å§‹å¯¹æˆ˜</button>
    </div>

    <!-- ========== æˆ˜æ–—ç•Œé¢ ========== -->
    <div id="battlePanel" class="battle-panel">
        <div class="flex-row">
            <span class="turn-indicator" id="turnDisplay">âš¡ å›åˆ âš¡</span>
            <div>
                <button class="action-btn" id="nextTurnBtn">â–¶ æ‰§è¡Œå›åˆ</button>
                <button class="action-btn" id="resetBtn">ğŸ”„ é‡æ–°é…å°†</button>
            </div>
        </div>

        <div class="battlefield">
            <!-- ç©å®¶0 -->
            <div class="player-card" id="player0Card">
                <div class="player-name" id="p0Name">å…³ç¾½</div>
                <div class="hp-bar-bg"><div class="hp-bar-fill" id="p0HpBar" style="width:100%"></div></div>
                <div class="stats-grid">
                    <div class="stat-item">â¤ï¸ è¡€é‡ <span id="p0Hp">15000</span></div>
                    <div class="stat-item">ğŸ§  æ™ºåŠ› <span id="p0Zhi">10.0</span></div>
                    <div class="stat-item">ğŸ’ª æ­¦åŠ› <span id="p0Wu">10.0</span></div>
                    <div class="stat-item">âš¡ é€ æˆä¼¤å®³ <span id="p0Shang">100</span>%</div>
                    <div class="stat-item">ğŸ›¡ï¸ å—åˆ°ä¼¤å®³ <span id="p0Shou">100</span>%</div>
                </div>
                <div id="p0SkillsDiv"></div>
            </div>
            <!-- ç©å®¶1 -->
            <div class="player-card" id="player1Card">
                <div class="player-name" id="p1NameSpan">å•å¸ƒ</div>
                <div class="hp-bar-bg"><div class="hp-bar-fill" id="p1HpBar" style="width:100%"></div></div>
                <div class="stats-grid">
                    <div class="stat-item">â¤ï¸ è¡€é‡ <span id="p1Hp">15000</span></div>
                    <div class="stat-item">ğŸ§  æ™ºåŠ› <span id="p1Zhi">10.0</span></div>
                    <div class="stat-item">ğŸ’ª æ­¦åŠ› <span id="p1Wu">10.0</span></div>
                    <div class="stat-item">âš¡ é€ æˆä¼¤å®³ <span id="p1Shang">100</span>%</div>
                    <div class="stat-item">ğŸ›¡ï¸ å—åˆ°ä¼¤å®³ <span id="p1Shou">100</span>%</div>
                </div>
                <div id="p1SkillsDiv"></div>
            </div>
        </div>
        <div class="log-panel" id="logPanel">
            <div class="log-entry">âš”ï¸ æ¸¸æˆå¼€å§‹ï¼</div>
        </div>
    </div>
</div>

<script>
(function() {
    // ---------- æŠ€èƒ½æ•°æ® ----------
    const skillList = [
        { id: 1, name: "æ™®æ”»", dfn: 1, desc: "å›åˆå†…ï¼Œé€ æˆ100%å…µåˆƒä¼¤å®³" },
        { id: 2, name: "åå‡»", dfn: 0, desc: "å—åˆ°ä¼¤å®³æ—¶åå‡»ï¼Œä»¤æ•Œæ–¹å—åˆ°80%å…µåˆƒä¼¤å®³(ä¸å‘åŠ¨æŠ€èƒ½)å¹¶å¢åŠ å…¶2%å—åˆ°ä¼¤å®³" },
        { id: 3, name: "ä¹˜èƒœè¿½å‡»", dfn: 4, desc: "é€ æˆä¼¤å®³æ—¶ï¼Œæœ‰75%æ¦‚ç‡é€ æˆ80%å…µåˆƒä¼¤å®³" },
        { id: 4, name: "é“éª‘æ¨ªå†²", dfn: 2, desc: "å›åˆå¼€å§‹æ—¶ï¼Œæœ‰100%æ¦‚ç‡å¯¹æ•Œæ–¹é€ æˆ500%å…µåˆƒä¼¤å®³ï¼Œè‹¥å¦‚æ­¤åšï¼Œä¸‹æ¬¡å‘åŠ¨æ—¶å‡å°‘10%æ¦‚ç‡å’Œ50%ä¼¤å®³ï¼ˆæ¦‚ç‡æœ€å°‘30%ï¼‰" },
        { id: 5, name: "è‰èˆ¹å€Ÿç®­", dfn: 0, desc: "å—åˆ°ä¼¤å®³æ—¶ï¼Œæœ‰50%æ¦‚ç‡å¯¹æ•Œæ–¹é€ æˆ140%æ™ºåŠ›ä¼¤å®³ï¼Œå¹¶ä»¤è‡ªèº«å—åˆ°ä¼¤å®³é™ä½1%" },
        { id: 6, name: "äº”é›·è½°é¡¶", dfn: 1, desc: "å›åˆå†…ï¼Œä½¿æ•Œå†›å—åˆ°0%è°‹ç•¥ä¼¤å®³ï¼Œé‡Šæ”¾5æ¬¡ã€‚æ¯é‡Šæ”¾ä¸€æ¬¡ï¼Œä¼¤å®³ç³»æ•°å¢åŠ 1%" },
        { id: 7, name: "é¿å…¶é”æ°”", dfn: 2, desc: "å‰å››å›åˆæ¯å›åˆå‡å°‘10%å—åˆ°ä¼¤å®³ï¼Œå…¶ä½™å›åˆæ¯å›åˆå¢åŠ 5%å—åˆ°ä¼¤å®³" },
        { id: 8, name: "ä»¥æˆ˜å…»æˆ˜", dfn: 3, desc: "å›åˆç»“æŸæ—¶å¢åŠ 1%å…µåŠ›ï¼Œ5%æ™ºåŠ›/5%æ­¦åŠ›" },
        { id: 9, name: "æ–‡æ­¦åŒå…¨", dfn: 1, desc: "å›åˆå†…ï¼Œä»¤æ•Œæ–¹å—åˆ°200%å…µåˆƒä¼¤å®³å’Œ200%æ™ºåŠ›ä¼¤å®³" },
        { id: 10, name: "ç ´ç”²", dfn: 4, desc: "é€ æˆä¼¤å®³æ—¶ï¼Œä»¤é€ æˆçš„ä¼¤å®³å€¼å¢åŠ 20%ï¼Œè‹¥å¦‚æ­¤åšï¼Œæˆ‘æ–¹çš„å—åˆ°ä¼¤å®³å€¼å¢åŠ 10%,è‹¥ä½ çš„ä½“åŠ›å€¼å°äºæ•Œæ–¹ä½“åŠ›å€¼ï¼Œæ­¤æŠ€èƒ½å¤±æ•ˆï¼Œå¦åˆ™â€œä»¤é€ æˆçš„ä¼¤å®³å€¼å¢åŠ 20%â€ä¸­çš„æ•°å€¼-1%ï¼ˆè‡³å¤šå‡å°‘19%ï¼‰" },
        { id: 11, name: "é‡æ•´æ——é¼“", dfn: 2, desc: "å›åˆå¼€å§‹æ—¶ï¼Œè‹¥ä½ çš„ä½“åŠ›å€¼å°äº5000ï¼Œä½ å¯ä»¥ä»¤ä½ å—åˆ°çš„ä¼¤å®³å˜ä¸º20%ï¼Œè‹¥å¦‚æ­¤åšï¼Œæ•Œæ–¹é€ æˆçš„ä¼¤å®³å˜æ›´ä¸º10%ï¼ˆä¸€å±€æ¸¸æˆå†…åªèƒ½å‘åŠ¨ä¸€æ¬¡ï¼‰" },
        { id: 12, name: "ä¸å±ˆ", dfn: 6, desc: "ä»»æ„ä¸€åç©å®¶çš„å›åˆç»“æŸæ—¶ï¼Œè‹¥ä½ çš„ä½“åŠ›å€¼å°äºæˆ–ç­‰äº0ï¼Œä½ å¯ä»¥å°†ä½“åŠ›å€¼å›å¤è‡³30000ï¼Œè‹¥å¦‚æ­¤åšï¼Œä½ é€ æˆçš„ä¼¤å®³å‡å°‘99%ï¼ˆä¸€å±€æ¸¸æˆå†…åªèƒ½å‘åŠ¨ä¸€æ¬¡ï¼‰" },
        { id: 13, name: "å·§å˜", dfn: 2, desc: "å›åˆå¼€å§‹æ—¶ï¼Œè®¾ä½ å—åˆ°ä¼¤å®³ä¸ºxï¼Œè‹¥xä¸ºæ­£æ•°ï¼šä»¤x=-(x+10%)ï¼Œè‹¥xä¸ºè´Ÿæ•°ï¼Œåˆ™ä»¤x=-(x-10%)" },
        { id: 14, name: "å››é¢æ¥šæ­Œ", dfn: 7, desc: "æ•Œæ–¹çš„å›åˆç»“æŸæ—¶ï¼Œè‹¥ä½ çš„å…µåŠ›å°äºæ•Œæ–¹çš„å…µåŠ›ï¼Œä»¤æ•Œæ–¹æ”»å‡»ä¼¤å®³å‡å°‘0%ï¼Œæ¯å‘åŠ¨ä¸€æ¬¡ï¼Œç³»æ•°å¢åŠ 11%,æœ€å¤š99%ï¼Œæ¯å‘åŠ¨ä¸€æ¬¡ï¼Œè‡ªèº«å—åˆ°ä¼¤å®³å¢åŠ æ­¤ç³»æ•°" },
        { id: 15, name: "è¶ç«æ‰“åŠ«", dfn: 3, desc: "å›åˆç»“æŸæ—¶ï¼Œè‹¥æˆ‘æ–¹çš„å…µåŠ›å¤§äºæ•Œæ–¹çš„å…µåŠ›ï¼Œä»¤æ•Œæ–¹çš„å—åˆ°ä¼¤å®³å¢åŠ 100%ï¼Œä½†æ˜¯ä½ å—åˆ°çš„ä¼¤å®³å°†å¢åŠ æ•Œæ–¹å—åˆ°ä¼¤å®³çš„70%" },
        { id: 16, name: "ç‹¼è¢­", dfn: 8, desc: "æ•Œæ–¹çš„å›åˆå¼€å§‹æ—¶ï¼Œè‹¥æˆ‘æ–¹å…µåŠ›å¤§äºæ•Œæ–¹å…µåŠ›çš„ä¸¤å€ï¼Œæˆ‘æ–¹æ‰§è¡Œä¸€ä¸ªé¢å¤–å›åˆï¼Œä½†æ˜¯æ­¤å›åˆæ²¡æœ‰å¼€å§‹å’Œç»“æŸé˜¶æ®µï¼Œè‹¥å¦‚æ­¤åšï¼Œæˆ‘æ–¹å—åˆ°çš„ä¼¤å®³å€¼+200%" },
        { id: 17, name: "ç ´é‡œæ²‰èˆŸ", dfn: 6, desc: "ä»»æ„ä¸€åç©å®¶çš„å›åˆç»“æŸæ—¶ï¼Œè‹¥æˆ‘æ–¹çš„ä½“åŠ›å€¼å°äºæ•Œæ–¹çš„ä½“åŠ›å€¼ï¼Œå¯ä»¥ä»¤æ•Œæ–¹çš„å…µåŠ›å‡å°‘æˆ‘æ–¹çš„å…µåŠ›ï¼Œç„¶åå°†æˆ‘æ–¹çš„å…µåŠ›è°ƒæ•´è‡³æ•Œæ–¹å…µåŠ›çš„2å€(æ¯å±€æ¸¸æˆåªèƒ½å‘åŠ¨ä¸€æ¬¡)" },
        { id: 18, name: "è‚ƒå†›", dfn: 9, desc: "é™¤æ­¤æ—¶åˆ»å¤–çš„ä»»æ„æ—¶åˆ»ï¼Œä»¤å…µåŠ›å¢åŠ 100ï¼Œæ­¦åŠ›å’Œæ™ºåŠ›å¢åŠ 0.1" },
        { id: 19, name: "å¥‡è¢­", dfn: 1, desc: "å›åˆå†…é™ä¸‰æ¬¡ï¼Œé˜³ï¼šä»¤æ•Œæ–¹+2%å—åˆ°ä¼¤å®³ï¼›é˜´ï¼šä»¤æ•Œæ–¹å—åˆ°120%å…µåˆƒä¼¤å®³ï¼Œæ¯å‘åŠ¨ä¸€æ¬¡ï¼Œåˆ‡æ¢é˜´é˜³çŠ¶æ€ï¼ˆé»˜è®¤ä¸ºé˜³ï¼‰" },
        { id: 20, name: "æ å¤º", dfn: 2, desc: "å›åˆå¼€å§‹æ—¶ï¼Œè·å¾—å¯¹æ–¹çš„éšæœºä¸€ä¸ªæŠ€èƒ½ï¼Œç„¶åä»¤å¯¹æ–¹è·å¾—è¿™ä¸ªæŠ€èƒ½(ä¸€å±€æ¸¸æˆå†…åªèƒ½å‘åŠ¨ä¸¤æ¬¡)" },
        { id: 21, name: "æ„ˆæˆ˜æ„ˆå‹‡", dfn: 1, desc: "å›åˆå†…ï¼Œå¯¹æ•Œæ–¹é€ æˆ100%å…µåˆƒä¼¤å®³ï¼Œæ¯å‘åŠ¨ä¸€æ¬¡ï¼Œç³»æ•°å¢åŠ 50%" },
    ];

    // ---------- å…¨å±€å˜é‡ ----------
    let players = [
        { hp: 15000, zhi: 10, wu: 10, shang: 1.0, shou: 1.0, name: "", ji: [], ttt: Array(20).fill(0) },
        { hp: 15000, zhi: 10, wu: 10, shang: 1.0, shou: 1.0, name: "", ji: [], ttt: Array(20).fill(0) }
    ];
    let turn = 0;           // å½“å‰è¡ŒåŠ¨ç©å®¶ç´¢å¼• (0æˆ–1)
    let lun = 0;            // å›åˆè®¡æ•°
    let gameOver = false;
    let logEntries = ["âš”ï¸ æ¸¸æˆå¼€å§‹ï¼"];

    // ---------- å·¥å…·å‡½æ•° ----------
    function addLog(msg) {
        logEntries.push(msg);
        if (logEntries.length > 30) logEntries.shift();
        const panel = document.getElementById('logPanel');
        if (panel) {
            panel.innerHTML = logEntries.map(t => `<div class="log-entry">${t}</div>`).join('');
            panel.scrollTop = panel.scrollHeight;
        }
    }

    function refreshUI() {
        for (let i = 0; i < 2; i++) {
            document.getElementById(`p${i}Name`).innerText = players[i].name;
            document.getElementById(`p${i}Hp`).innerText = Math.max(0, Math.floor(players[i].hp * 10) / 10);
            document.getElementById(`p${i}Zhi`).innerText = players[i].zhi.toFixed(2);
            document.getElementById(`p${i}Wu`).innerText = players[i].wu.toFixed(2);
            document.getElementById(`p${i}Shang`).innerText = Math.floor(players[i].shang * 100);
            document.getElementById(`p${i}Shou`).innerText = Math.floor(players[i].shou * 100);
            
            const hpPercent = Math.min(100, Math.max(0, (players[i].hp / 15000) * 100));
            document.getElementById(`p${i}HpBar`).style.width = hpPercent + '%';

            let skillHtml = '';
            players[i].ji.forEach(skill => {
                skillHtml += `<span class="skill-tag">${skill.name}</span>`;
            });
            document.getElementById(`p${i}SkillsDiv`).innerHTML = skillHtml;
        }
        document.getElementById('player0Card').classList.toggle('current-turn', turn === 0);
        document.getElementById('player1Card').classList.toggle('current-turn', turn === 1);
        document.getElementById('turnDisplay').innerText = `âš¡ ${players[turn].name}çš„å›åˆ âš¡`;
        document.getElementById('p1NameSpan').innerText = players[1].name;
    }

    // ---------- ä¼¤å®³ä¸æŠ€èƒ½ ----------
    function shou(x, y, pre, lei, flag) {
        if (gameOver) return;
        let num = pre * players[x].shou * players[y].shang * (lei ? players[y].wu : players[y].zhi);
        if (flag) {
            fd(0, x, y, num, lei, pre);
            fd(4, y, x, num, lei, pre);
        }
        addLog(`${players[x].name} å—åˆ° ${num.toFixed(2)} ç‚¹ ${lei ? 'å…µåˆƒ' : 'è°‹ç•¥'} ä¼¤å®³.`);
        players[x].hp -= num;
        if (players[x].hp < 0) players[x].hp = 0;
        fd(5, y, x, num, lei, pre);
        refreshUI();
    }

    function pugong(x, y) { shou(y, x, 1, 1, 1); }
    function fanji(x, y) { players[y].shou *= 1.02; addLog(`${players[y].name}å—åˆ°ä¼¤å®³å¢åŠ 2%`); shou(y, x, 0.80, 1, 0); }
    function chengshengzhuiji(x, y, num, lei) { if (Math.random() * 100 < 75) shou(y, x, 0.8, lei, 1); }
    function tieqihengchong(x, y) { if (Math.random() * 100 < Math.max(100 - players[x].ttt[1], 30.0)) { shou(y, x, 4 - players[x].ttt[1]/20.0, 1, 1); players[x].ttt[1] += 10; } }
    function caochuan(x, y) { if (Math.random() * 100 < 50) return; players[x].shou *= 0.99; addLog(`${players[x].name}å—åˆ°ä¼¤å®³å‡å°‘1%`); shou(y, x, 1.4, 0, 1); }
    function wulei(x, y) { for (let i=0; i<5; i++) { shou(y, x, 0 + players[x].ttt[2], 0, 1); players[x].ttt[2] += 0.01; } }
    function yangzhan(x, y) { players[x].hp *= 1.01; if (players[x].wu < players[x].zhi) players[x].wu *= 1.05; else players[x].zhi *= 1.05; }
    function ruiqi(x, y) { if (lun < 4) { players[x].shou *= 0.9; addLog(`${players[x].name}å—åˆ°ä¼¤å®³å‡å°‘10%`); } else { players[x].shou *= 1.05; addLog(`${players[x].name}å—åˆ°ä¼¤å®³å¢åŠ 5%`); } }
    function wenwu(x, y) { shou(y, x, 2, 0, 1); shou(y, x, 2, 1, 1); }
    function pojia(x, y) { if (players[x].ttt[7] === lun) return; if (players[x].hp < players[y].hp) { players[x].ttt[6] = 1; return; } players[x].shang *= 1.2 - players[x].ttt[8]/100.0; players[x].shou *= 1.1; players[x].ttt[7] = lun; players[x].ttt[8]++; if (players[x].ttt[8] > 19) players[x].ttt[8] = 19; addLog(`${players[x].name}é€ æˆçš„ä¼¤å®³å€¼å¢åŠ ï¼Œå—åˆ°çš„ä¼¤å®³å€¼å¢åŠ 10%`); }
    function chongzheng(x, y) { if (players[x].ttt[5]) return; players[x].ttt[5] = 1; players[x].shou = 0.2; players[y].shang = 0.1; addLog(`${players[x].name}è§¦å‘é‡æ•´æ——é¼“ï¼`); }
    function buqu(x, y) { if (players[x].ttt[3]) return; players[x].ttt[3] = 1; players[x].hp = 30000; players[x].shang *= 0.01; addLog(`${players[x].name}è§¦å‘ä¸å±ˆï¼å…µåŠ›å›å¤è‡³30000`); }
    function qiaobian(x, y) { players[x].shou = -(players[x].shou + (players[x].shou > 0 ? 0.1 : -0.1)); addLog(`${players[x].name}å—åˆ°çš„ä¼¤å®³å€¼æŒ‰ç…§æè¿°å˜åŒ–`); }
    function simian(x, y) { if (players[x].hp >= players[y].hp) return; addLog(`${players[x].name}è§¦å‘å››é¢æ¥šæ­Œ!`); players[y].shang *= (1 - Math.min(players[x].ttt[4]/100.0, 0.99)); players[x].shou *= 1 + Math.min(players[x].ttt[4]/100.0, 0.99); players[x].ttt[4] += 11; }
    function chenhuo(x, y) { players[y].shou *= 2; addLog(`${players[y].name}å—åˆ°çš„ä¼¤å®³å€¼å¢åŠ 100%`); players[x].shou += players[y].shou * 0.7; }
    function langxi(x, y) { if (players[x].hp <= players[y].hp * 2) return; lun++; addLog(`${players[x].name}å‘åŠ¨ç‹¼è¢­ï¼`); players[x].shou += 2; fd(1, x, y, 0, 0, 0); }
    function pofu(x, y) { if (players[x].ttt[9] || players[x].hp >= players[y].hp) return; players[x].ttt[9] = 1; players[y].hp -= players[x].hp; players[x].hp = players[y].hp * 2; addLog(`${players[x].name}å’Œ${players[y].name}çš„å…µåŠ›æŒ‰æŠ€èƒ½è°ƒæ•´`); }
    function sujun(x) { players[x].hp += 100; players[x].wu += 0.1; players[x].zhi += 0.1; }
    function qixi(x, y) { for (let i=0; i<3; i++) { if (players[x].ttt[10]) shou(y, x, 120, 1, 1); else { players[x].shang += 0.02; addLog(`${players[x].name}é€ æˆçš„ä¼¤å®³å€¼å¢åŠ 2%`); } players[x].ttt[10] = !players[x].ttt[10]; } }
    function lueduo(x, y) { if (players[x].ttt[11] > 2) return; players[x].ttt[11]++; addLog(`${players[x].name}å‘åŠ¨æ å¤ºï¼`); let ttt = Math.floor(Math.random() * players[y].ji.length); players[x].ji.push(players[y].ji[ttt]); players[y].ji.push(skillList[19]); }
    function yuzhan(x, y) { shou(y, x, 100 + players[x].ttt[12], 1, 1); players[x].ttt[12] += 50; }

    function fd(dfn, x, y, num, lei, pre) {
        if (gameOver) return;
        if (dfn !== 9) fd(9, x, y, num, lei, pre);
        for (let skill of players[x].ji) {
            if (skill.dfn === dfn) {
                addLog(`${players[x].name} å‘åŠ¨ ${skill.name}`);
                if (skill.name === "æ™®æ”»") pugong(x, y);
                else if (skill.name === "åå‡»") fanji(x, y);
                else if (skill.name === "ä¹˜èƒœè¿½å‡»") chengshengzhuiji(x, y, num, lei);
                else if (skill.name === "é“éª‘æ¨ªå†²") tieqihengchong(x, y);
                else if (skill.name === "è‰èˆ¹å€Ÿç®­") caochuan(x, y);
                else if (skill.name === "äº”é›·è½°é¡¶") wulei(x, y);
                else if (skill.name === "é¿å…¶é”æ°”") ruiqi(x, y);
                else if (skill.name === "ä»¥æˆ˜å…»æˆ˜") yangzhan(x, y);
                else if (skill.name === "æ–‡æ­¦åŒå…¨") wenwu(x, y);
                else if (skill.name === "ç ´ç”²") pojia(x, y);
                else if (skill.name === "é‡æ•´æ——é¼“" && players[x].hp <= 5000) chongzheng(x, y);
                else if (skill.name === "ä¸å±ˆ" && players[x].hp <= 0) buqu(x, y);
                else if (skill.name === "å·§å˜") qiaobian(x, y);
                else if (skill.name === "å››é¢æ¥šæ­Œ") simian(x, y);
                else if (skill.name === "è¶ç«æ‰“åŠ«") chenhuo(x, y);
                else if (skill.name === "ç‹¼è¢­") langxi(x, y);
                else if (skill.name === "ç ´é‡œæ²‰èˆŸ") pofu(x, y);
                else if (skill.name === "è‚ƒå†›") sujun(x);
                else if (skill.name === "å¥‡è¢­") qixi(x, y);
                else if (skill.name === "æ å¤º") lueduo(x, y);
                else if (skill.name === "æ„ˆæˆ˜æ„ˆå‹‡") yuzhan(x, y);
            }
        }
    }

    function execTurn() {
        if (gameOver) return;
        let x = turn;
        let y = 1 - turn;

        addLog(`---------- å›åˆ ${lun+1} Â· ${players[x].name} ----------`);
        fd(8, y, x, 0, 0, 0);
        fd(2, x, y, 0, 0, 0);
        fd(1, x, y, 0, 0, 0);
        fd(3, x, y, 0, 0, 0);
        fd(6, x, y, 0, 0, 0);
        fd(6, y, x, 0, 0, 0);
        fd(7, y, x, 0, 0, 0);

        if (players[0].hp <= 0 || players[1].hp <= 0) {
            gameOver = true;
            let winner = players[0].hp <= 0 ? players[1].name : players[0].name;
            addLog(`ğŸ† æ¸¸æˆç»“æŸï¼èƒœåˆ©è€…ï¼š${winner} ğŸ†`);
            document.getElementById('nextTurnBtn').disabled = true;
        } else {
            turn = 1 - turn;
            lun++;
        }
        refreshUI();
    }

    function startGame() {
        // è¯»å–ç©å®¶è¾“å…¥
        let p1Name = document.getElementById('p1Name').value.trim();
        let p2Name = document.getElementById('p2Name').value.trim();
        let p1SkillStr = document.getElementById('p1Skills').value.trim();
        let p2SkillStr = document.getElementById('p2Skills').value.trim();

        if (!p1Name) p1Name = "å…³ç¾½";
        if (!p2Name) p2Name = "å•å¸ƒ";

        function parseSkills(str) {
            if (!str) return [];
            let parts = str.split(/\s+/).map(Number).filter(n => !isNaN(n) && n >= 1 && n <= 21);
            return parts.map(id => skillList.find(s => s.id === id)).filter(s => s);
        }

        let p1Skills = parseSkills(p1SkillStr);
        let p2Skills = parseSkills(p2SkillStr);

        // å¦‚æœæ²¡æœ‰è¾“å…¥ä»»ä½•æœ‰æ•ˆæŠ€èƒ½ï¼Œç»™é»˜è®¤
        if (p1Skills.length === 0) p1Skills = [skillList[0]];
        if (p2Skills.length === 0) p2Skills = [skillList[0]];

        // ç¡®ä¿æ¯ä¸ªç©å®¶æœ€å¤š7ä¸ªæŠ€èƒ½ï¼ˆC++åŸç‰ˆæ˜¯7ä¸ªï¼‰
        if (p1Skills.length > 7) p1Skills = p1Skills.slice(0, 7);
        if (p2Skills.length > 7) p2Skills = p2Skills.slice(0, 7);

        players = [
            { hp: 15000, zhi: 10, wu: 10, shang: 1.0, shou: 1.0, name: p1Name, ji: p1Skills, ttt: Array(20).fill(0) },
            { hp: 15000, zhi: 10, wu: 10, shang: 1.0, shou: 1.0, name: p2Name, ji: p2Skills, ttt: Array(20).fill(0) }
        ];

        turn = 0;
        lun = 0;
        gameOver = false;
        logEntries = ["âš”ï¸ æ¸¸æˆå¼€å§‹ï¼"];

        document.getElementById('setupPanel').style.display = 'none';
        document.getElementById('battlePanel').style.display = 'block';
        document.getElementById('nextTurnBtn').disabled = false;
        
        refreshUI();
        addLog(`ğŸ‘‘ ${p1Name} æŠ€èƒ½ï¼š${p1Skills.map(s=>s.name).join('ã€')}`);
        addLog(`âš”ï¸ ${p2Name} æŠ€èƒ½ï¼š${p2Skills.map(s=>s.name).join('ã€')}`);
    }

    function resetGame() {
        document.getElementById('setupPanel').style.display = 'block';
        document.getElementById('battlePanel').style.display = 'none';
    }

    // ç»‘å®šäº‹ä»¶
    document.getElementById('startGameBtn').addEventListener('click', startGame);
    document.getElementById('nextTurnBtn').addEventListener('click', execTurn);
    document.getElementById('resetBtn').addEventListener('click', resetGame);
})();
</script>
</body>
</html>